import { TextFieldCellExampleTypes } from './examples/TextFieldCellExampleTypes/TextFieldCellExampleTypes';
import { TextFieldCellExampleAlertMessage } from './examples/TextFieldCellExampleAlertMessage/TextFieldCellExampleAlertMessage';
import { MdxTabs } from '@consta/stand';

# Обзор

`TextFieldCell` позволяет вводить текст, числа или массивы строк. Компонент базируется на [`TextField`](##LIBS.LIB.STAND/lib:uikit/stand:components-textfield-canary) и подготовлен для использования в таблицах. Основные свойства компонента идентичны [`TextField`](##LIBS.LIB.STAND/lib:uikit/stand:components-textfield-canary).

# Тип

Доступные типы компонента:

- `text` - текст
- `textarea` - многострочный текст
- `number` - число
- `textarray` - массив строк

<MdxTabs>

<TextFieldCellExampleTypes />

```tsx
import React, { useCallback, useState } from 'react';

import { Table, TableColumn, TableRenderCell } from '@consta/table/Table';
import { TextFieldCell } from '@consta/table/TextFieldCell';

type Row = {
  text: string;
  textarea: string;
  textareaAutosize: string;
  number: string;
  textArray: string[];
};

const rows: Row[] = [
  {
    text: 'value1',
    textarea: 'value2',
    textareaAutosize: 'value3',
    number: 'value4',
    textArray: ['value5', 'value6'],
  },
];

const CellTypeText: TableRenderCell<Row> = (row) => {
  const [value, setValue] = useState<string | null>(row.row.text);

  return (
    <TextFieldCell type="text" value={value} onChange={setValue} size="m" />
  );
};

const CellTypeTextArea: TableRenderCell<Row> = (row) => {
  const [value, setValue] = useState<string | null>(row.row.textarea);

  return (
    <TextFieldCell
      type="textarea"
      value={value}
      onChange={setValue}
      size="m"
      rows={3}
      lineClamp={6}
      resize
      clearButton
    />
  );
};

const CellTypeTextAreaAutosize: TableRenderCell<Row> = (row) => {
  const [value, setValue] = useState<string | null>(row.row.textareaAutosize);

  return (
    <TextFieldCell
      type="textarea"
      value={value}
      resize="auto"
      maxRows={6}
      lineClamp={6}
      onChange={setValue}
      size="m"
      clearButton
    />
  );
};

const CellTypeNumber: TableRenderCell<Row> = (row) => {
  const [value, setValue] = useState<string | null>(row.row.number);

  return (
    <TextFieldCell
      type="number"
      value={value}
      incrementButtons
      clearButton
      onChange={setValue}
      size="m"
    />
  );
};

const CellTypeTextArray: TableRenderCell<Row> = (row) => {
  const [value, setValue] = useState<string[] | null>(row.row.textArray);

  const [inputValue, setInputValue] = useState<string | null>(null);
  const onChangeValueArray = useCallback((value: string[] | null) => {
    setValue(value);
    setInputValue(null);
  }, []);

  return (
    <TextFieldCell
      type="textarray"
      value={value}
      clearButton
      onChange={onChangeValueArray}
      inputValue={inputValue}
      onInputChange={setInputValue}
      readModeRender={(value) => value?.join(', ')}
      size="m"
    />
  );
};

const columns: TableColumn<Row>[] = [
  {
    title: 'TextArray',
    accessor: 'textArray',
    renderCell: CellTypeTextArray,
    minWidth: 200,
  },
  {
    title: 'Text',
    accessor: 'text',
    renderCell: CellTypeText,
    minWidth: 200,
  },

  {
    title: 'Textarea',
    accessor: 'textarea',
    renderCell: CellTypeTextArea,
    minWidth: 200,
  },
  {
    title: 'Textarea autosize',
    accessor: 'textareaAutosize',
    renderCell: CellTypeTextAreaAutosize,
    minWidth: 200,
  },

  {
    title: 'Number',
    accessor: 'number',
    renderCell: CellTypeNumber,
    minWidth: 200,
  },
];

export const TextFieldCellExampleTypes = () => (
  <Table rows={rows} columns={columns} />
);
```

</MdxTabs>

# Обработка ошибок

В компоненте есть 2 свойства для отображения ошибок.

`indicator` - отображает уголок в правом верхнем углу ячейки, в режиме чтения.
`status` - отображает обводку поля в режиме редактирования.

Для вывода ошибки можете использовать [`Popover`](##LIBS.LIB.STAND/lib:uikit/stand:components-popover-stable) и [`Informer`](##LIBS.LIB.STAND/lib:uikit/stand:components-informer-stable)

В примере снизу ошибка возникает если количество элементов в массиве больше 10.

<MdxTabs>

<TextFieldCellExampleAlertMessage />

```tsx
import { Example } from '@consta/stand';
import { Informer } from '@consta/uikit/Informer';
import {
  animateTimeout,
  cnMixPopoverAnimate,
} from '@consta/uikit/MixPopoverAnimate';
import { Popover } from '@consta/uikit/Popover';
import { useClickOutside } from '@consta/uikit/useClickOutside';
import { useFlag } from '@consta/uikit/useFlag';
import { useHover } from '@consta/uikit/useHover';
import React, { useCallback, useEffect, useRef, useState } from 'react';
import { Transition } from 'react-transition-group';

import { Table, TableColumn, TableRenderCell } from '@consta/table/Table';
import { TextFieldCell } from '@consta/table/TextFieldCell';

type Row = {
  col: string;
  col2: string;
  textArray: string[];
};

const rows: Row[] = [
  {
    col: 'value1',
    textArray: Array.from({ length: 11 }, (_, i) => `элемент-${i + 1}`),
    col2: 'value2',
  },
];

const CellTypeTextArray: TableRenderCell<Row> = (row) => {
  const popoverRef = useRef<HTMLDivElement>(null);
  const cellRef = useRef<HTMLDivElement>(null);
  const inputRef = useRef<HTMLInputElement>(null);

  const [value, setValue] = useState<string[] | null>(row.row.textArray);
  const [open, setOpen] = useFlag();

  const onChangeValue = useCallback((value: string[] | null) => {
    setValue(value);
    if (inputRef.current) {
      inputRef.current.value = '';
    }
  }, []);

  const error = !!(value && value.length > 10);

  useEffect(() => setOpen.set(error), [error]);

  useHover({
    isActive: error,
    refs: [popoverRef, cellRef],
    onHover: setOpen.on,
    onBlur: setOpen.off,
    hoverDelay: 500,
    blurDelay: 300,
  });

  useClickOutside({
    isActive: open,
    handler: setOpen.off,
    ignoreClicksInsideRefs: [popoverRef, cellRef],
  });

  return (
    <>
      <TextFieldCell
        type="textarray"
        value={value}
        clearButton
        onChange={onChangeValue}
        readModeRender={(value) => value?.join(', ')}
        size="m"
        status={error ? 'alert' : undefined}
        indicator={error ? 'alert' : undefined}
        ref={cellRef}
        inputRef={inputRef}
      />

      <Transition
        in={open}
        unmountOnExit
        timeout={animateTimeout}
        nodeRef={popoverRef}
      >
        {(animate) => {
          return (
            <Popover
              style={{ width: 200, zIndex: 100 }}
              className={cnMixPopoverAnimate({ animate })}
              offset="2xs"
              anchorRef={cellRef}
              ref={popoverRef}
              direction="rightStartUp"
              possibleDirections={[
                'rightStartUp',
                'rightStartDown',
                'downStartRight',
                'upStartRight',
              ]}
              spareDirection="downStartRight"
            >
              <Informer
                status="alert"
                view="bordered"
                label="Количество не должно превышать 10 значений"
              />
            </Popover>
          );
        }}
      </Transition>
    </>
  );
};

const columns: TableColumn<Row>[] = [
  {
    title: 'Колонка',
    accessor: 'col',
    minWidth: 150,
  },
  {
    title: 'Редактируемый массив',
    accessor: 'textArray',
    renderCell: CellTypeTextArray,
    minWidth: 200,
  },
  {
    title: 'Колонка',
    accessor: 'col2',
    minWidth: 150,
  },
];

export const TextFieldCellExampleAlertMessage = () => (
  <Example col={1}>
    <Table rows={rows} columns={columns} />
  </Example>
);
```

</MdxTabs>

# Свойства

| Свойство                                                                                                                | Тип                                                             | По умолчанию | Описание                                         |
| ----------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------- | ------------ | ------------------------------------------------ |
| [`size?`](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-textfield-canary/tab:dev/hash:размер)                         | `'s' \| 'm'`                                                    | `'m'`        | Размер ячейки                                    |
| `lineClamp?`                                                                                                            | `number`                                                        | -            | Ограничение количества строк текста              |
| `readModeRender?`                                                                                                       | `(value?: TextFieldPropValue<TYPE>) => React.ReactNode`         | -            | Функция для отображения значения в режиме чтения |
| [`level?`](##LIBS.LIB.STAND.TAB/lib:table/stand:components-datacell-stable/tab:dev/hash:уровень-вложенности)            | `number`                                                        | -            | Уровень вложенности ячейки                       |
| [`indicator?`](##LIBS.LIB.STAND.TAB/lib:table/stand:components-datacell-stable/tab:dev/hash:индикатор)                  | `'alert' \| 'warning'`                                          | -            | Индикатор состояния                              |
| `truncate?`                                                                                                             | `boolean`                                                       | -            | Обрезка текста многоточием                       |
| [`value?`](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-textfield-canary/tab:dev/hash:значение)                      | `TextFieldPropValue<TYPE>`                                      | -            | Значение поля ввода                              |
| `onChange?`                                                                                                             | `TextFieldPropOnChange<TYPE>`                                   | -            | Обработчик изменения значения                    |
| `defaultValue?`                                                                                                         | `TextFieldPropValue<TYPE>`                                      | -            | Значение по умолчанию                            |
| `id?`                                                                                                                   | `string`                                                        | -            | Идентификатор поля                               |
| `name?`                                                                                                                 | `string`                                                        | -            | Имя поля                                         |
| `disabled?`                                                                                                             | `boolean`                                                       | -            | Флаг отключения поля                             |
| `maxLength?`                                                                                                            | `number`                                                        | -            | Максимальная длина текста                        |
| `minLength?`                                                                                                            | `number`                                                        | -            | Минимальная длина текста                         |
| [`placeholder?`](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-textfield-canary/tab:dev/hash:подсказка)               | `string`                                                        | -            | Подсказка для ввода                              |
| [`leftSide?`](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-textfield-canary/tab:dev/hash:дополнительная-информация)  | `React.ReactNode`                                               | -            | Элемент слева внутри поля                        |
| [`rightSide?`](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-textfield-canary/tab:dev/hash:дополнительная-информация) | `React.ReactNode`                                               | -            | Элемент справа внутри поля                       |
| [`clearButton?`](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-textfield-canary/tab:dev/hash:кнопка-для-очистки-поля) | `boolean`                                                       | -            | Флаг отображения кнопки очистки                  |
| `iconClear?`                                                                                                            | `IconComponent`                                                 | -            | Иконка для кнопки очистки                        |
| `iconSize?`                                                                                                             | `'s' \| 'm'`                                                    | -            | Размер иконок                                    |
| `onClear?`                                                                                                              | `React.MouseEventHandler`                                       | -            | Обработчик очистки поля                          |
| `inputRef?`                                                                                                             | `React.Ref`                                                     | -            | Ссылка на DOM-элемент input                      |
| [`type?`](#тип)                                                                                                         | `'text' \| 'textarea' \| 'textarray' \| 'password' \| 'number'` | `'text'`     | Тип поля ввода                                   |
| `max?`                                                                                                                  | `number`                                                        | -            | Максимальное значение                            |
| `min?`                                                                                                                  | `number`                                                        | -            | Минимальное значение                             |
| [`step?`](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-textfield-canary/tab:dev/hash:шаг--значения-и-диапазон)       | `number`                                                        | -            | Шаг изменения значения                           |
| `incrementButtons?`                                                                                                     | `boolean`                                                       | -            | Флаг отображения кнопок инкремента               |
| `iconShowPassword?`                                                                                                     | `IconComponent`                                                 | -            | Иконка показа пароля                             |
| `iconHidePassword?`                                                                                                     | `IconComponent`                                                 | -            | Иконка скрытия пароля                            |
| [`resize?`](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-textfield-canary/tab:dev/hash:изменение-высоты)             | `boolean \| 'auto'`                                             | -            | Возможность изменения размера                    |
| [`minRows?`](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-textfield-canary/tab:dev/hash:автоматическая-высота)       | `number`                                                        | -            | Минимальное количество строк                     |
| [`maxRows?`](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-textfield-canary/tab:dev/hash:автоматическая-высота)       | `number`                                                        | -            | Максимальное количество строк                    |
| [`rows?`](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-textfield-canary/tab:dev/hash:поле-в-несколько-строк)         | `number`                                                        | -            | Количество строк                                 |
| `renderValueItem?`                                                                                                      | `(item: string) => React.ReactNode`                             | -            | Функция отображения элемента массива             |
| `inputValue?`                                                                                                           | `string \| null`                                                | -            | Значение поля ввода для массива                  |
| `onInputChange?`                                                                                                        | `((value: string \| null) => void)`                             | -            | Обработчик изменения значения ввода              |
| `className?`                                                                                                            | `string`                                                        | -            | Дополнительный CSS-класс.                        |
